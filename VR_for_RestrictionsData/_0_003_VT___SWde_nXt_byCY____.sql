/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 0.003    ---------------------------------------------------------------------------------------- '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***                                                                                                                                                         ***/
/***     >>>>>         This script creates semi-WIDE set of (working and/or final) data from the 'Global Restriction on Religion Study'            <<<<<     ***/
/***                                                                                                                                                         ***/
/***                    -  Data includes CALCULATED/AGGREGATED variables (from the basic variables used ad source)                                           ***/
/***                    -  Data of each row are by country-year (semi-wide)                                                                                  ***/
/***                    -  As any wide/semi-wide set of data, these views and lookup tables only include numeric values for GR&SH R                          ***/
/***                    -  ==> DEFAULT:   FD  initial section to run sql script using final data        (it will create view & lookup table)                 ***/
/***                    -  ==>    COMMENT FD  initial section                                                                                                ***/
/***                           & UNCOMENT  W  initial section to run sql script using working data      (it will create view & lookup table)                 ***/
/***                                                                                                                                                         ***/
/***                                                                                                                                                         ***/
/***                                               |                 W                 |                F D                |                                 ***/
/***                                               |        working environment        |            final  data            |                                 ***/
/***                     --------------------------+-----------------------------------+-----------------------------------+                                 ***/
/***                                    database:  |            [GRSHRcode]            |          [forum_ResAnal]          |                                 ***/
/***                     --------------------------+-----------------------------------+-----------------------------------+                                 ***/
/***                               1st step view:  |  [vr___03w]                       |  [vr___03_]                       |                                 ***/
/***                     --------------------------+-----------------------------------+-----------------------------------+                                 ***/
/***                       2ns step lookup table:  |  [vr___03_wDB_W&Xtra_byCtry&Year] |  [vr___03_cDB_W&Xtra_byCtry&Year] |                                 ***/
/***                     --------------------------+-----------------------------------+-----------------------------------+                                 ***/
/***                                                                                                                                                         ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/*******                                                  ***/                                                                                              /***/
/*******                                                  ***/                                                                                              /***/
--	/***                                                  ***/                                                                                              /***/
--	/***   ********************   ****************        ***/                                                                                              /***/
--	/***   ********************   *****************       ***/                                                                                              /***/
--	/***   ***                    ***            ***      ***/                                                                                              /***/
	/***   ***                    ***             ***     ***/     USE [forum_ResAnal]                                                                      /***/
	/***   ***                    ***              ***    ***/     SET ANSI_NULLS ON                                                                        /***/
	/***   ****************       ***              ***    ***/     SET QUOTED_IDENTIFIER ON                                                                 /***/
	/***   ****************       ***              ***    ***/                                                                                              /***/
	/***   ***                    ***              ***    ***/     declare     @CUDBNAME           nvarchar(max) = N'forum_ResAnal'                         /***/
	/***   ***                    ***              ***    ***/     declare     @VIEWNAME           nvarchar(max) = N'vr___03_'                              /***/
	/***   ***                    ***              ***    ***/     declare     @TABLNAME           nvarchar(max) = N'vr___03_cDB_W&Xtra_byCtry&Year'        /***/
	/***   ***                    ***             ***     ***/     declare     @SOURCE01           nvarchar(max) = N'vr___02_'                              /***/
--	/***   ***                    ***            ***      ***/                                                                                              /***/
--	/***   ***                    *****************       ***/                                                                                              /***/
--	/***   ***                    ****************        ***/                                                                                              /***/
--	/***                                                  ***/                                                                                              /***/
/*******                                                  ***/                                                                                              /***/
/*******                                                  ***/                                                                                              /***/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/*******                                                  ***/                                                                                              /***/
/*******                                                  ***/                                                                                              /***/
--	/***                                                  ***/                                                                                              /***/
--	/***   *****                                 *****    ***/                                                                                              /***/
--	/***   *****                                 *****    ***/                                                                                              /***/
--	/***     ***                                 ***      ***/                                                                                              /***/
--	/***      ***                               ***       ***/     USE [GRSHRcode]                                                                          /***/
--	/***       ***                             ***        ***/     SET ANSI_NULLS ON                                                                        /***/
--	/***        ***                           ***         ***/     SET QUOTED_IDENTIFIER ON                                                                 /***/
--	/***         ***           ***           ***          ***/                                                                                              /***/
--	/***          ***         *****         ***           ***/     declare     @CUDBNAME           nvarchar(max) = N'GRSHRcode'                             /***/
--	/***           ***       *** ***       ***            ***/     declare     @VIEWNAME           nvarchar(max) = N'vr___03w'                              /***/
--	/***            ***     ***   ***     ***             ***/     declare     @TABLNAME           nvarchar(max) = N'vr___03_wDBtW&Xtra_byCtry&Year'        /***/
--	/***             ***   ***     ***   ***              ***/     declare     @SOURCE01           nvarchar(max) = N'vr___02w'                              /***/
--	/***              *** ***       *** ***               ***/                                                                                              /***/
--	/***              *******       *******               ***/                                                                                              /***/
--	/***               *****         *****                ***/                                                                                              /***/
--	/***                                                  ***/                                                                                              /***/
/*******                                                  ***/                                                                                              /***/
/*******                                                  ***/                                                                                              /***/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/************************************************************/     declare     @ALLCODE            nvarchar(max)                                            /***/
/************************************************************/     declare     @SBEGCODE           nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_0           nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_01        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_02        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_03        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_04        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_05        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_06        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_07        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_08        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_09        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_10        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_11        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_1_12        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_2           nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_2_00        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_2_01        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_2_02        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_2_03        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_2_04        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_2_05        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3           nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3_00        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3_01        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3_02        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3_03        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3_04        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3_05        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_3_06        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_4           nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_4_00        nvarchar(max)                                            /***/
/************************************************************/     declare     @SBCODE_4_01        nvarchar(max)                                            /***/
/************************************************************/ --  declare     @SBCODE_4_02        nvarchar(max)                                            /***/
/************************************************************/ --  declare     @SBCODE_5           nvarchar(max)                                            /***/
/************************************************************/ --  declare     @SBCODE_5_00        nvarchar(max)                                            /***/
/************************************************************/ --  declare     @SBCODE_5_01        nvarchar(max)                                            /***/
/************************************************************/     declare     @ENDCODET           nvarchar(max)                                            /***/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
--*** NOTE -> May need to:
--                          Clean XSG_25n27  as rowmax(GRX_25_01_2010 SHX_27_01_2010)
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @SBEGCODE =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N' ALTER  VIEW .[dbo].'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/* name of view to be updated   -------------------------------------------------------------------------------------------------------------------------------*/                    
     quotename(@VIEWNAME)
/*--------------------------------------------------------------------------------------------------------------------------------- name of view to be updated */
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
  AS
 '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*** main select statement starts ******************************************************************************************************************************/
N'
  SELECT * FROM
   (
    SELECT 
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/




/***************************************************************************************************************************************************************/
set     @SBCODE_4_01=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 4_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_change_extent                 - categorized extent of change variables added on JAN 2017              ----------------------------------*/
/*
                  WHEN [GRI_change] >=  1.95 THEN   3.00                  -- (if  GRIchange >=.  1.95 & GRIchange != .   )
                  WHEN [GRI_change] >=  0.95 THEN   2.00                  -- (if  GRIchange >=   0.95 & GRIchange <  1.95)
                  WHEN [GRI_change] >=  0.10 THEN   1.00                  -- (if  GRIchange >=   0.1  & GRIchange <  0.95)
                  WHEN [GRI_change] >  -0.10 THEN   0.00                  -- (gen GRIchange_extent                =  0   )
                  WHEN [GRI_change] >  -0.95 THEN  -1.00                  -- (if  GRIchange <=  -0.1  & GRIchange > -0.95)
                  WHEN [GRI_change] >  -1.95 THEN  -2.00                  -- (if  GRIchange <=  -0.95 & GRIchange > -1.95)
                  WHEN [GRI_change] <= -1.95 THEN  -3.00                  -- (if  GRIchange <=  -1.95 & GRIchange != .   )

                  WHEN [SHI_change] >=  1.95 THEN   3.00                  -- (if  SHIchange >=.  1.95 & SHIchange != .   )
                  WHEN [SHI_change] >=  0.95 THEN   2.00                  -- (if  SHIchange >=   0.95 & SHIchange <  1.95)
                  WHEN [SHI_change] >=  0.10 THEN   1.00                  -- (if  SHIchange >=   0.1  & SHIchange <  0.95)
                  WHEN [SHI_change] >  -0.10 THEN   0.00                  -- (gen SHIchange_extent                =  0   )
                  WHEN [SHI_change] >  -0.95 THEN  -1.00                  -- (if  SHIchange <=  -0.1  & SHIchange > -0.95)
                  WHEN [SHI_change] >  -1.95 THEN  -2.00                  -- (if  SHIchange <=  -0.95 & SHIchange > -1.95)
                  WHEN [SHI_change] <= -1.95 THEN  -3.00                  -- (if  SHIchange <=  -1.95 & SHIchange != .   )
*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_change_extent] 
         =        CAST ((
                  CASE
                  WHEN [GRI_change] >=  1.95 THEN   3.00
                  WHEN [GRI_change] >=  0.95 THEN   2.00
                  WHEN [GRI_change] >=  0.10 THEN   1.00
                  WHEN [GRI_change] >  -0.10 THEN   0.00
                  WHEN [GRI_change] >  -0.95 THEN  -1.00
                  WHEN [GRI_change] >  -1.95 THEN  -2.00
                  WHEN [GRI_change] <= -1.95 THEN  -3.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_change_extent                 - categorized extent of change variables added on JAN 2017              ----------------------------------*/
/*
                  WHEN [SHI_change] >=  1.95 THEN   3.00                  -- (if  SHIchange >=.  1.95 & SHIchange != .   )
                  WHEN [SHI_change] >=  0.95 THEN   2.00                  -- (if  SHIchange >=   0.95 & SHIchange <  1.95)
                  WHEN [SHI_change] >=  0.10 THEN   1.00                  -- (if  SHIchange >=   0.1  & SHIchange <  0.95)
                  WHEN [SHI_change] >  -0.10 THEN   0.00                  -- (gen SHIchange_extent                =  0   )
                  WHEN [SHI_change] >  -0.95 THEN  -1.00                  -- (if  SHIchange <=  -0.1  & SHIchange > -0.95)
                  WHEN [SHI_change] >  -1.95 THEN  -2.00                  -- (if  SHIchange <=  -0.95 & SHIchange > -1.95)
                  WHEN [SHI_change] <= -1.95 THEN  -3.00                  -- (if  SHIchange <=  -1.95 & SHIchange != .   )
*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI_change_extent] 
         =        CAST ((
                  CASE
                  WHEN [SHI_change] >=  1.95 THEN   3.00
                  WHEN [SHI_change] >=  0.95 THEN   2.00
                  WHEN [SHI_change] >=  0.10 THEN   1.00
                  WHEN [SHI_change] >  -0.10 THEN   0.00
                  WHEN [SHI_change] >  -0.95 THEN  -1.00
                  WHEN [SHI_change] >  -1.95 THEN  -2.00
                  WHEN [SHI_change] <= -1.95 THEN  -3.00
                  END
                                                               ) AS DECIMAL (38,2))     , /* 4_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/




set     @SBCODE_4_00 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 4_00 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         *
FROM (
     SELECT
                                                                                          /* 4_00 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/****************************************************************************************************************** selection of Step-4 calculated variables ***/


/*** selection of variables including numeric values + Step-3 calculated variables *****************************************************************************/
/***************************************************************************************************************************************************************/
set     @SBCODE_3_06=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 3_06 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_CHANGE              - JAN2017               --------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_change] 
         =
                  CAST ((
                        [GRI] - coalesce(lag([GRI]) 
                        over (
                        PARTITION BY [Nation_fk] 
                        ORDER BY [Nation_fk], [Question_Year]), NULL)
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_CHANGE              - JAN2017 */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI_change] 
         =
                  CAST ((
                        [SHI] - coalesce(lag([SHI])
                        over (
                        PARTITION BY [Nation_fk] 
                        ORDER BY [Nation_fk], [Question_Year]), NULL)
                                                               ) AS DECIMAL (38,2))     , /* 3_06 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_3_05=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 3_05 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_19_b - f,        scaled       - 2015                 -----------------------------------------------------------------------------------*/
/*                                      (0 = None, .2 = 1-9 cases, .4 = 10-200 cases, .6 = 201 - 1000 cases, .8 = 1001 - 9999 cases, 1 = 10000+ cases) */
/*
                            WHEN GRI_19_b   >  10000 THEN 1     -- (1   = 10000+      cases)
                            WHEN GRI_19_b   >   1000 THEN 0.8   -- ( .8 =  1001 - 9999 cases)
                            WHEN GRI_19_b   >    200 THEN 0.6   -- ( .6 =   201 - 1000 cases)
                            WHEN GRI_19_b   >     10 THEN 0.4   -- ( .4 =    10 -  200 cases)
                            WHEN GRI_19_b   >      0 THEN 0.2   -- ( .2 =     1 -    9 cases)
                            WHEN GRI_19_b   =      0 THEN 0.0   -- (0   =  None             )
*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_19_b_scaled]
       = CAST ((
         CASE 
              WHEN GRI_19_b   >  10000 THEN 1
              WHEN GRI_19_b   >   1000 THEN 0.8
              WHEN GRI_19_b   >    200 THEN 0.6
              WHEN GRI_19_b   >     10 THEN 0.4
              WHEN GRI_19_b   >      0 THEN 0.2
              WHEN GRI_19_b   =      0 THEN 0.0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_c_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_c   >  10000 THEN 1
              WHEN GRI_19_c   >   1000 THEN 0.8
              WHEN GRI_19_c   >    200 THEN 0.6
              WHEN GRI_19_c   >     10 THEN 0.4
              WHEN GRI_19_c   >      0 THEN 0.2
              WHEN GRI_19_c   =      0 THEN 0.0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_d_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_d   >  10000 THEN 1
              WHEN GRI_19_d   >   1000 THEN 0.8
              WHEN GRI_19_d   >    200 THEN 0.6
              WHEN GRI_19_d   >     10 THEN 0.4
              WHEN GRI_19_d   >      0 THEN 0.2
              WHEN GRI_19_d   =      0 THEN 0.0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_e_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_e   >  10000 THEN 1
              WHEN GRI_19_e   >   1000 THEN 0.8
              WHEN GRI_19_e   >    200 THEN 0.6
              WHEN GRI_19_e   >     10 THEN 0.4
              WHEN GRI_19_e   >      0 THEN 0.2
              WHEN GRI_19_e   =      0 THEN 0.0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_f_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_f   >  10000 THEN 1
              WHEN GRI_19_f   >   1000 THEN 0.8
              WHEN GRI_19_f   >    200 THEN 0.6
              WHEN GRI_19_f   >     10 THEN 0.4
              WHEN GRI_19_f   >      0 THEN 0.2
              WHEN GRI_19_f   =      0 THEN 0.0
         END
                                                               ) AS DECIMAL (38,2))     , /* 3_05 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_3_04=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 3_04 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_scaled - index based on yr2007                      ------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_scaled] 
         =        CAST ((
                  CASE
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''low''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GRI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 1.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''moderate''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GRI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 2.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''high''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GRI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 3.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''very high''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GRI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))     , /* 3_04 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_3_03=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 3_03 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_scaled             - index based on yr2007         ------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI_scaled]
         =        CAST ((
                  CASE
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''low''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''SHI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 1.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''moderate''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''SHI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 2.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''high''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''SHI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 3.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''very high''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''SHI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))     , /* 3_03 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_3_02=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 3_02 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GFI_scaled             - index based on yr2007         ------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GFI_scaled] 
         =        CAST ((
                  CASE
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''low''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GFI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 1.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''moderate''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GFI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 2.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''high''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GFI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 3.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = ''very high''
                                  AND  [Point]      = ''highest''
                                  AND  [Field_type] = ''GFI''
                                  AND  [Field_year] = ''2007''
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))     , /* 3_02 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_3_01=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 3_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_rd_1d               GRI_rounded index              -------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_rd_1d] 
         =        CAST ((
                                  GRI 
                                                               ) AS DECIMAL (38,1))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_rounded index                 */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI_rd_1d] 
         =        CAST ((
                                  SHI 
                                                               ) AS DECIMAL (38,1))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GFI_rounded index                 */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GFI_rd_1d] 
         =        CAST ((
                                  GFI
                                                               ) AS DECIMAL (38,1))     , /* 3_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/





set     @SBCODE_3_00 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 3_00 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         *
FROM (
     SELECT
                                                                                          /* 3_00 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/****************************************************************************************************************** selection of Step-3 calculated variables ***/


/*** selection of variables including numeric values + Step-2 calculated variables *****************************************************************************/
/***************************************************************************************************************************************************************/
set     @SBCODE_2_04=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 2_04 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI                       GRI index             --------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI]
         =
                  CAST ((((
                                [GRI_01]
                         +      [GRI_02]
                         +      [GRI_03]
                         +      [GRI_04]
                         +      [GRI_05]
                         +      [GRI_06]
                         +      [GRI_07]
                         +      [GRI_08_for_index]
                         +      [GRI_09]
                         +      [GRI_10]
                         +      [GRI_11]
                         +      [GRI_12]
                         +      [GRI_13]
                         +      [GRI_14]
                         +      [GRI_15]
                         +      [GRI_16]
                         +      [GRI_17]
                         +      [GRI_18]
                         +      [GRI_19]
                         +      [GRI_20]
                                                       ) /2   )
                                                               ) AS DECIMAL (38,32))    , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------- GRI */
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI                       SHI index             --------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI]
         =        CAST ((((
                                [SHI_01]
                         +      [SHI_02]
                         +      [SHI_03]
                         +      [SHI_04]
                         +      [SHI_05]
                         +      [SHI_06]
                         +      [SHI_07]
                         +      [SHI_08]
                         +      [SHI_09]
                         +      [SHI_10]
                         +      [SHI_11_for_index]
                         +      [SHI_12]
                         +      [SHI_13]
                                                       ) /1.3 )
                                                               ) AS DECIMAL (38,32))    , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------- SHI */
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GFI                       GFI index             --------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GFI] 
         =        CAST ((((
                                [GRI_20_01]
                         +      [GRI_20_02]
                         + ( (  [GRI_20_03_a]
                              + [GRI_20_03_b]
                              + [GRI_20_03_c]
                                               ) /3 )
                         +      [GRI_20_04]
                         +      [GRI_20_05]
                                                     ) /5 ) 
                                                           *10
                                                               ) AS DECIMAL (38,32))    , /* 2_04 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_2_03=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 2_03 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_01_xG1                    Government & Social harassment of Christianity ---------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_01_xG1]
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG1 + SHI_01_xG1 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_01_xG2           --     Government & Social harassment of Islam           --------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_01_xG2] 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG2 + SHI_01_xG2 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_01_xG3           --     Government & Social harassment of Buddhism          ------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_01_xG3]
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG3 + SHI_01_xG3 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_01_xG4           --     Government & Social harassment of Hinduism          ------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_01_xG4]
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG4 + SHI_01_xG4 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_01_xG5           --     Government & Social harassment of Judaism           ------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_01_xG5]
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG5 + SHI_01_xG5 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_01_xG6           --     Government & Social harassment of Other ("New" Religions, Ancient Religions, Sikhs, Zoroastrianism)  -----------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_01_xG6]
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG6 + SHI_01_xG6 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_01_xG7           --     Government & Social harassment of Ethnic or Tribal Religions   -------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_01_xG7]
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG7 + SHI_01_xG7 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , /* 2_03 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_2_02=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 2_02 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_01_summary_a_ny           for toplines             -------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI_01_summary_a_ny]
       = CAST ((
         CASE 
              WHEN SHI_01     =  0.00
              THEN               0.00
              WHEN SHI_01     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nya
       = CAST ((
         CASE 
              WHEN SHI_01_a   >  0.00
              THEN               1.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyb
       = CAST ((
         CASE 
              WHEN SHI_01_b   >  0.00
              THEN               1.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyc
       = CAST ((
         CASE 
              WHEN SHI_01_c   >  0.00
              THEN               1.03
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyd
       = CAST ((
         CASE 
              WHEN SHI_01_d   >  0.00
              THEN               1.04
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nye
       = CAST ((
         CASE 
              WHEN SHI_01_e   >  0.00
              THEN               1.05
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyf
       = CAST ((
         CASE 
              WHEN SHI_01_f   >  0.00
              THEN               1.06
         END
                                                               ) AS DECIMAL (38,2))     , /* 2_02 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_2_01=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 2_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_242526_ny           for toplines                   -------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_242526_ny]
       = CAST ((
         CASE WHEN GRX_24     = 0.00
               AND SHX_25     = 0.00
               AND SHX_26     = 0.00
              THEN              0.00
              WHEN GRX_24     > 0.00
                OR SHX_25     > 0.00
                OR SHX_26     > 0.00
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_242526_ny1
       = CAST ((
         CASE WHEN GRX_24     = 0.00
               AND SHX_25     = 0.00
               AND SHX_26     = 0.00
              THEN              NULL
              WHEN GRX_24     = 1.00
                OR SHX_25     = 1.00
                OR SHX_26     = 1.00
              THEN              1.00
              WHEN GRX_24     = 0.67
                OR SHX_25     = 0.67
                OR SHX_26     = 0.67
              THEN              0.67
              WHEN GRX_24     = 0.33
                OR SHX_25     = 0.33
                OR SHX_26     = 0.33
              THEN              0.33
              END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 XSG_25n27_ny         --           for toplines   -------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [XSG_25n27_ny]
       = CAST ((
         CASE WHEN GRX_25_ny  = 0.00
               AND SHX_27_ny  = 0.00
              THEN              0.00
              WHEN GRX_25_ny  = 0.01
                OR SHX_27_ny  = 0.01
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_25n27_ny2
       = CAST ((
         CASE WHEN GRX_25_ny2 = 0.02
                OR SHX_27_ny2 = 0.02
              THEN              0.02
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_25n27_ny3
       = CAST ((
         CASE WHEN GRX_25_ny3 = 0.03
                OR SHX_27_ny3 = 0.03
              THEN              0.03
              END
                                                               ) AS DECIMAL (38,2))     , /* 2_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_2_00 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 2_00 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         *
FROM (
     SELECT
                                                                                          /* 2_00 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/****************************************************************************************************************** selection of Step-2 calculated variables ***/


/*** selection of variables including numeric values + Step-1 calculated variables *****************************************************************************/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_11=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_11 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_20      -   (to be used in index calculation)      -------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_20]
         =        ROUND(
                  CAST ((((
                                [GRI_20_01]
                         +      [GRI_20_02]
                         + ( (  [GRI_20_03_a]
                              + [GRI_20_03_b]
                              + [GRI_20_03_c]
                                               ) / 3 )
                         +      [GRI_20_04]
                         +      [GRI_20_05]
                                                       ) / 5  )
                                                               ) AS DECIMAL (38,2)) ,2) , '
/*----------------------------------------------------------------------------------------------------------------------------------------------------- GRI_20 */
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_20_top                         ---------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_20_top]
         =        CAST ((
                  CASE
                  WHEN GRI_20_03_a = 1
                    OR GRI_20_03_b = 1
                    OR GRI_20_03_c = 1
                    OR GRI_20_02   > 0.5
                  THEN               1.00
                  WHEN GRI_20_01   > 0
                    OR GRI_20_02   > 0
                    OR GRI_20_03_a > 0
                    OR GRI_20_03_b > 0
                    OR GRI_20_03_c > 0
                    OR GRI_20_04   > 0
                    OR GRI_20_05   > 0
                  THEN               0.50
                  ELSE               0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*------------------------------------------------------------------------------------------------------------------------------------------------- GRI_20_top */
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_20_03_top                      ---------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_20_03_top]
         =        CAST ((
                  CASE
                  WHEN GRI_20_03_a >= GRI_20_03_b
                   AND GRI_20_03_a >= GRI_20_03_c
                  THEN GRI_20_03_a
                  WHEN GRI_20_03_b >= GRI_20_03_a
                   AND GRI_20_03_b >= GRI_20_03_c
                  THEN GRI_20_03_b
                  WHEN GRI_20_03_c >= GRI_20_03_b
                   AND GRI_20_03_c >= GRI_20_03_c
                  THEN GRI_20_03_c
                  ELSE NULL
                  END
                                                               ) AS DECIMAL (38,2))     , /* 1_11 */'
/*---------------------------------------------------------------------------------------------------------------------------------------------- GRI_20_03_top */
/***************************************************************************************************************************************************************/
set     @SBCODE_1_10=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_10 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_01      -   to be used in index calculation)       -------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI_01]
         =        CAST ((
                  (
                  CAST ((
                    ( CASE
                      WHEN SHI_01_a > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_b > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_c > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_d > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_e > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_f > 0 THEN 1
                      ELSE                   0
                       END                     )
                                                       
                                                               ) AS DECIMAL (38,2))
                                                                                    / 6 )
                                                               ) AS DECIMAL (38,2))     , '
/*----------------------------------------------------------------------------------------------------------------------------------------------------- SHI_01 */
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_01_summary_b   -------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [SHI_01_summary_b]
         =        CAST ((
                  (
                  CAST ((
                    ( CASE
                      WHEN SHI_01_a > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_b > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_c > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_d > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_e > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_f > 0 THEN 1
                      ELSE                   0
                       END                     )
                                                       
                                                               ) AS DECIMAL (38,2))
                                                                                    / 6 )

                                                               ) AS DECIMAL (38,2))     , /* 1_10 */'
/*------------------------------------------------------------------------------------------------------------------------------------------- SHI_01_summary_b */
/***************************************************************************************************************************************************************/
set     @SBCODE_1_09=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_09 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_01_[a,b,c,d,e,f]_dummy for tables of question answers by country   ---------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHI_01_a_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_a   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_01_b_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_b   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_01_c_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_c   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_01_d_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_d   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_01_e_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_e   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_01_f_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_f   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))     , /* 1_09 */'
/*--------------------------------------------------------------------------------------------------------------------------------- SHI_01_[a,b,c,d,e,f]_dummy */
/***************************************************************************************************************************************************************/
set     @SBCODE_1_08=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_08 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_11_xG1  -   Gov harassment of Christianity       ---------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  [GRI_11_xG1]
         =        CAST ((
                  CASE
                  WHEN   GRI_11_01a
                       + GRI_11_01b
                       + GRI_11_02
                       + GRI_11_03
                       + GRI_11_11
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_11_xG2  -   Gov harassment of Islam */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_11_xG2
         =        CAST ((
                  CASE
                  WHEN   GRI_11_04
                       + GRI_11_05
                       + GRI_11_06
                       + GRI_11_12
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_11_xG3  -   Gov harassment of Buddhism */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_11_xG3 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_07
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_11_xG4  -   Gov harassment of Hinduism */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_11_xG4 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_08
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_11_xG5  -   Gov harassment of Judaism */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_11_xG5
         =        CAST ((
                  CASE
                  WHEN   GRI_11_09
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_11_xG6  -   Gov harassment of Other ("New" Religions, Ancient Religions, Sikhs, Zoroastrianism) */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_11_xG6 
         =        CAST ((
                  CASE
                  WHEN   isnull(GRI_11_10, 0)
                       + isnull(GRI_11_14, 0)
                       + isnull(GRI_11_15, 0)
                       + isnull(GRI_11_16, 0)
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_11_xG7  -   Gov harassment of Ethnic or Tribal Religions */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_11_xG7
         =        CAST ((
                  CASE
                  WHEN   GRI_11_13
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , /* 1_08 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_07=
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_07 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_01_xG1  -   Social harassment of Christianity */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHI_01_xG1
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_01a
                       + SHI_01_x_01b
                       + SHI_01_x_02
                       + SHI_01_x_03
                       + SHI_01_x_11
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/* Social harassment of Islam */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         SHI_01_xG2 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_04
                       + SHI_01_x_05
                       + SHI_01_x_06
                       + SHI_01_x_12
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/* Social harassment of Buddhism */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         SHI_01_xG3 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_07
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/* Social harassment of Hinduism */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         SHI_01_xG4 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_08
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/* Social harassment of Judaism */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         SHI_01_xG5 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_09
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/* Social harassment of Other ('New' Religions, Ancient Religions, Sikhs, Zoroastrianism) */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         SHI_01_xG6 
         =        CAST ((
                  CASE
                  WHEN   isnull(SHI_01_x_10, 0)
                       + isnull(SHI_01_x_14, 0)
                       + isnull(SHI_01_x_15, 0)
                       + isnull(SHI_01_x_16, 0)
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/* Social harassment of Ethnic or Tribal Religions */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         SHI_01_xG7
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_13
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))     , /* 1_07 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_06 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_06 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_08 recoded to be used as index-factor */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_08_for_index
         =        CAST ((
                  CASE
                  WHEN GRI_08  = 0.5
                  THEN           1
                  ELSE GRI_08
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/* recode SHI_Q_11 to be used as index-factor */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         SHI_11_for_index
         =        CAST ((
                  CASE
                  WHEN SHI_11  = 0.5
                  THEN           1
                  ELSE SHI_11
                  END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_16               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_16_ny
       = CAST ((
         CASE 
              WHEN GRI_16     =  0.00
              THEN               0.00
              WHEN GRI_16     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_16_ny1
       = CAST ((
         CASE 
              WHEN GRI_16     =  0.00
              THEN               NULL
              WHEN GRI_16     >  0.00
              THEN               GRI_16
         END
                                                               ) AS DECIMAL (38,2))     , /* 1_06 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_05 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_05 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_19             for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_19_ny
       = CAST ((
         CASE 
              WHEN GRI_19     =  0.00
              THEN               0.00
              WHEN GRI_19     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_ny1
       = CAST ((
         CASE 
              WHEN GRI_19     =  0.00
              THEN               NULL
              WHEN GRI_19     >  0.00
              THEN               GRI_19
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_19_summ_ny          for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_19_summ_ny
       = CAST ((
         CASE 
              WHEN GRI_19     =  0.00
              THEN               0.00
              WHEN GRI_19     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_summ_nyb
       = CAST ((
         CASE 
              WHEN GRI_19_b   >  0.00
              THEN               1.02
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_summ_nyc
       = CAST ((
         CASE 
              WHEN GRI_19_c   >  0.00
              THEN               1.03
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_summ_nyd
       = CAST ((
         CASE 
              WHEN GRI_19_d   >  0.00
              THEN               1.04
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_summ_nye
       = CAST ((
         CASE 
              WHEN GRI_19_e   >  0.00
              THEN               1.05
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRI_19_summ_nyf
       = CAST ((
         CASE 
              WHEN GRI_19_f   >  0.00
              THEN               1.06
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRI_19_x              for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRI_19_x
       = CAST ((
                   ISNULL(GRI_19_b, 0)
                 + ISNULL(GRI_19_c, 0)
                 + ISNULL(GRI_19_d, 0)
                 + ISNULL(GRI_19_e, 0)
                 + ISNULL(GRI_19_f, 0)
                                                               ) AS DECIMAL (38,2))     , /* 1_05 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_04 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_04 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_04_ny          for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHI_04_ny
       = CAST ((
         CASE 
              WHEN SHI_04     =  0.00
              THEN               0.00
              WHEN SHI_04     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_04_ny1
       = CAST ((
         CASE 
              WHEN SHI_04     =  0.00
              THEN               NULL
              WHEN SHI_04     >  0.00
              THEN               SHI_04
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_05_ny          for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHI_05_ny
       = CAST ((
         CASE 
              WHEN SHI_05     =  0.00
              THEN               0.00
              WHEN SHI_05     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_05_ny1
       = CAST ((
         CASE 
              WHEN SHI_05     =  0.00
              THEN               NULL
              WHEN SHI_05     >  0.00
              THEN               SHI_05
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_07_ny          for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHI_07_ny
       = CAST ((
         CASE 
              WHEN SHI_07     =  0.00
              THEN               0.00
              WHEN SHI_07     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHI_07_ny1
       = CAST ((
         CASE 
              WHEN SHI_07     =  0.00
              THEN               NULL
              WHEN SHI_07     >  0.00
              THEN               SHI_07
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHI_01_x              for toplines??? - added on Dec2015  */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHI_01_x
       = CAST ((
                   ISNULL(SHI_01_b, 0)
                 + ISNULL(SHI_01_c, 0)
                 + ISNULL(SHI_01_d, 0)
                 + ISNULL(SHI_01_e, 0)
                 + ISNULL(SHI_01_f, 0)
                                                               ) AS DECIMAL (38,2))     , /* 1_04 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_03 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_03 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*                 GRX_22                  for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--       = CAST ((
--         CASE WHEN ISNULL(GRX_22   , 9)   = 9
--               AND ISNULL(GRX_22_01, 9)   = 9
--               AND ISNULL(GRX_22_02, 9)   = 9
--               AND ISNULL(GRX_22_04, 9)   = 9
--              THEN               NULL
--              WHEN ISNULL(GRX_22   , 0)   < 0.66
--               AND ISNULL(GRX_22_01, 0)   < 0.66
--               AND ISNULL(GRX_22_02, 0)   < 0.66
--               AND ISNULL(GRX_22_04, 0)   < 0.66
--              THEN              0
--              WHEN ISNULL(GRX_22   , 0)  >= 0.66
--               AND ISNULL(GRX_22_01, 0)  >= 0.66
--               AND ISNULL(GRX_22_02, 0)  >= 0.66
--               AND ISNULL(GRX_22_04, 0)  >= 0.66
--              THEN              0.01
--              END
--                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRX_22               for toplines                                                                        */
/*     ,           GRX_22_ny1    => this was the former name                                                                */
/*                                  current does not display "NO" -- this would be just a dummy but it has NOT BEEN TESTED: */
/*                                  ELSE 1000                     -- this for checking any value non-recoded                */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRX_22_aggreg
       = CAST ((
         CASE WHEN ISNULL(GRX_22   , 9)  = 9
               AND ISNULL(GRX_22_01, 9)  = 9
               AND ISNULL(GRX_22_02, 9)  = 9
               AND ISNULL(GRX_22_04, 9)  = 9
              THEN               NULL
              WHEN ISNULL(GRX_22   , 0)  < 0.66
               AND ISNULL(GRX_22_01, 0)  < 0.66
               AND ISNULL(GRX_22_02, 0)  < 0.66
           
		       AND ISNULL(GRX_22_04, 0)  < 0.66
              THEN              0
              WHEN ISNULL(GRX_22   , 0)  < 1.00
               AND ISNULL(GRX_22_01, 0)  < 1.00
               AND ISNULL(GRX_22_02, 0)  < 1.00
               AND ISNULL(GRX_22_04, 0)  < 1.00
              THEN              0.67
              WHEN GRX_22     = 1.00
                OR GRX_22_01  = 1.00
                OR GRX_22_02  = 1.00
                OR GRX_22_04  = 1.00
              THEN              1.00
              END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                                                                   END of CODE -> NOT BEEN TESTED                         */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRX_22_01               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRX_22_01_ny
       = CAST ((
         CASE WHEN GRX_22_01  < 0.66
              THEN              0
              WHEN GRX_22_01 >= 0.66
              THEN              0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRX_22_01_ny1
       = CAST ((
         CASE WHEN GRX_22_01  < 0.66
              THEN              NULL
              WHEN GRX_22_01 >= 0.66
              THEN              GRX_22_01
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRX_22_02               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRX_22_02_ny
       = CAST ((
         CASE WHEN GRX_22_02  < 0.66
              THEN              0
              WHEN GRX_22_02 >= 0.66
              THEN              0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRX_22_02_ny1
       = CAST ((
         CASE WHEN GRX_22_02  < 0.66
              THEN              NULL
              WHEN GRX_22_02 >= 0.66
              THEN              GRX_22_02
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRX_22_03               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRX_22_03_ny
       = CAST ((
         CASE WHEN GRX_22_03  <  0.66
              THEN               0
              WHEN GRX_22_03 >=  0.66
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRX_22_03_ny1
       = CAST ((
         CASE WHEN GRX_22_03  <  0.66
              THEN               NULL
              WHEN GRX_22_03 >=  0.66
              THEN               GRX_22_03
        END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRX_22_04               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRX_22_04_ny
       = CAST ((
         CASE WHEN GRX_22_04  <  0.66
              THEN               0
              WHEN GRX_22_04 >=  0.66
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRX_22_04_ny1
       = CAST ((
         CASE WHEN GRX_22_04  <  0.66
              THEN               NULL
              WHEN GRX_22_04 >=  0.66
              THEN               GRX_22_04
         END
                                                               ) AS DECIMAL (38,2))     , /* 1_03 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_02 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_02 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRX_24               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRX_24_ny
       = CAST ((
         CASE WHEN GRX_24     =  0
              THEN               0
              WHEN GRX_24     >  0
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRX_24_ny1
       = CAST ((
         CASE WHEN GRX_24     =  0
              THEN               NULL
              WHEN GRX_24     >  0
              THEN               GRX_24
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 GRX_25               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   GRX_25_ny
       = CAST ((
         CASE 
              WHEN GRX_25_01  =  0.00
              THEN               0.00
              WHEN GRX_25_01  =  1.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRX_25_ny2
       = CAST ((
         CASE 
              WHEN GRX_25_02  =  1.00
              THEN               0.02
         END
                                                               ) AS DECIMAL (38,2))     ,
                   GRX_25_ny3
       = CAST ((
         CASE 
              WHEN GRX_25_03  =  1.00
              THEN               0.03
         END
                                                               ) AS DECIMAL (38,2))     , /* 1_02 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
set     @SBCODE_1_01 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                                                                                          /* 1_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHX_25               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHX_25_ny
       = CAST ((
         CASE WHEN SHX_25     =  0
              THEN               0
              WHEN SHX_25     >  0
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHX_25_ny1
       = CAST ((
         CASE WHEN SHX_25     =  0
              THEN               NULL
              WHEN SHX_25     >  0
              THEN               SHX_25
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHX_26               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHX_26_ny
       = CAST ((
         CASE WHEN SHX_26     =  0
              THEN               0
              WHEN SHX_26     >  0
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHX_26_ny1
       = CAST ((
         CASE WHEN SHX_26     =  0
              THEN               NULL
              WHEN SHX_26     >  0
              THEN               SHX_26
         END
                                                               ) AS DECIMAL (38,2))     , '
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*                 SHX_27               for toplines */
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                   SHX_27_ny
       = CAST ((
         CASE 
              WHEN SHX_27_01  =  0.00
              THEN               0.00
              WHEN SHX_27_01  =  1.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHX_27_ny2
       = CAST ((
         CASE 
              WHEN SHX_27_02  =  1.00
              THEN               0.02
         END
                                                               ) AS DECIMAL (38,2))     ,
                   SHX_27_ny3
       = CAST ((
         CASE 
              WHEN SHX_27_03  =  1.00
              THEN               0.03
         END
                                                               ) AS DECIMAL (38,2))     , /* 1_01 */'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/****************************************************************************************************************** selection of Step-1 calculated variables ***/


/*** selection of variables including numeric values ***********************************************************************************************************/
set     @SBCODE_0 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
         *
FROM
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/* Source including numeric values aggregated by country/religion & year   ------------------------------------------------------------------------------------*/
     quotename(@CUDBNAME) + N'.[dbo].' + quotename(@SOURCE01)
/*-------------------------------------------------------------------------------------- Source including numeric values aggregated by country/religion & year */
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N' 
)                                                                                                                                                       AS NV_S1
' 
/*********************************************************************************************************** selection of variables including numeric values ***/


/***************************************************************************** selection of variables including numeric values + Step-1 calculated variables ***/

/*** enclosing parenthesis for selection of numeric values + Steps 1 & 2 ***************************************************************************************/
set     @SBCODE_2 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N' 
)                                                                                                                                                       AS NV_S2
' 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/************************************************************************ selection of variables including numeric values + Steps 1 & 2 calculated variables ***/

/*** enclosing parenthesis for selection of numeric values + Steps 1, 2 & 3 ************************************************************************************/
set     @SBCODE_3 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N' 
)                                                                                                                                                       AS NV_S3
' 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/********************************************************************* selection of variables including numeric values + Steps 1, 2 & 3 calculated variables ***/

/*** enclosing parenthesis for selection of numeric values + Steps 1, 2, 3 & 4 *********************************************************************************/
set     @SBCODE_4 =
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N' 
)                                                                                                                                                       AS NV_S4
' 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/****************************************************************** selection of variables including numeric values + Steps 1, 2, 3 & 4 calculated variables ***/


/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
SET                    @ALLCODE =
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                   @SBEGCODE
--                                    +            @SBCODE_5_01
--                                    +            @SBCODE_5_00
--                                    +            @SBCODE_4_02
                                      +            @SBCODE_4_01
                                      +            @SBCODE_4_00
                                      +            @SBCODE_3_06
                                      +            @SBCODE_3_05
                                      +            @SBCODE_3_04
                                      +            @SBCODE_3_03
                                      +            @SBCODE_3_02
                                      +            @SBCODE_3_01
                                      +            @SBCODE_3_00
                                      +            @SBCODE_2_04
                                      +            @SBCODE_2_03
                                      +            @SBCODE_2_02
                                      +            @SBCODE_2_01
                                      +            @SBCODE_2_00
                                      +            @SBCODE_1_11
                                      +            @SBCODE_1_10
                                      +            @SBCODE_1_09
                                      +            @SBCODE_1_08
                                      +            @SBCODE_1_07
                                      +            @SBCODE_1_06
                                      +            @SBCODE_1_05
                                      +            @SBCODE_1_04
                                      +            @SBCODE_1_03
                                      +            @SBCODE_1_02
                                      +            @SBCODE_1_01
                                      +            @SBCODE_0
                                      +            @SBCODE_2
                                      +            @SBCODE_3
                                      +            @SBCODE_4
--                                    +            @SBCODE_5
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/*** checking / executing SQL statement that has been stored as a string variable ******************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE                                     /***        display the currently stored code (to be executed)                           ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
	EXEC sp_executesql @ALLCODE                                     /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/



/***************************************************************************************************************************************************************/
set     @ENDCODET =
/***************************************************************************************************************************************************************/
N'
  IF OBJECT_ID  (N''' + quotename(@CUDBNAME) + N'.[dbo].' + quotename(@TABLNAME) + N''', N''U'') IS NOT NULL
    DROP TABLE      ' + quotename(@CUDBNAME) + N'.[dbo].' + quotename(@TABLNAME) + N'
 SELECT * INTO      ' + quotename(@CUDBNAME) + N'.[dbo].' + quotename(@TABLNAME) + N'
          FROM      ' + quotename(@CUDBNAME) + N'.[dbo].' + quotename(@VIEWNAME) + N'
'
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ENDCODET                                    /***        display the currently stored code (to be executed)                           ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
	EXEC              (@ENDCODET)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
--	SELECT * FROM [vr___03_wDBtW&Xtra_byCtry&Year]
--	SELECT * FROM [vr___03_cDB_W&Xtra_byCtry&Year] 
/***************************************************************************************************************************************************************/

/**********************************************************************************************************************************************************/
/*****                                              BackUp current Tables                                                                             *****/
/**********************************************************************************************************************************************************/
  USE [forum]
GO
/**********************************************************************************************************************************************************/
/*    CHANGES FROM SCRIPT DATED 20161213
      BACKUP STORED AS [_bk_forum].[dbo].[Pew_Answer_NoStd_20161213]
      WERE WRONG                                                          *********************************************************************************/
/**********************************************************************************************************************************************************/


/**********************************************************************************************************************************************************/
--  DECLARE @CrDt    varchar( 8)
--  SET     @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))
/*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
--EXEC ( ' SELECT *
--                  INTO  [_bk_forum].[dbo].[Pew_Answer_NoStd_' + @CrDt + ']
--                  FROM      [forum].[dbo].[Pew_Answer_NoStd]'               )
/**********************************************************************************************************************************************************/



/**********************************************************************************************************************************************************/
--- 18 records where I replaced text ONLY
)
/**********************************************************************************************************************************************************/
-- Update from CTE table:
--   LINKED tables cannot be directly used if >1 table would have the same exposed name
--   Then we use correlation names to distinguish them.
--    UPDATE    [forum].[dbo].[Pew_Answer_NoStd]
--    SET       [forum].[dbo].[Pew_Answer_NoStd].[Answer_Wording]  =    [BKUP].[Answer_Wording]
/*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
--------select *
FROM
          [forum].[dbo].[Pew_Answer_NoStd]                               PANS
FULL
JOIN
----   SELECT * FROM
      [_bk_forum].[dbo].[Pew_Answer_NoStd_20161213]                      BKUP
   ON 
       PANS.[Answer_pk]
      =BKUP.[Answer_pk]
WHERE
--       PANS.[Question_fk]
--     !=BKUP.[Question_fk]
--       OR
       PANS.[Answer_Wording]
     !=BKUP.[Answer_Wording]
  AND
       PANS.[Answer_value_NoStd]
      =BKUP.[Answer_value_NoStd]
  AND
       PANS.[Answer_Std_fk]
      =BKUP.[Answer_Std_fk]
  AND
       PANS.[Answer_pk] IN ( 2707, 2998, 3219, 3665 )
--/**********************************************************************************************************************************************************/
----- TEST: check 04/18 answers linked MORE THAN ONCE to Ctry+Var+Yr
--SELECT * FROM  [GRSHRcode].[dbo].[tr___01_]
--   INNER JOIN      [FORUM].[dbo].[Pew_Answer]                               T
--      ON 
--                  [Answer_fk]
--                 =[Answer_pk]
--WHERE
--[Answer_pk]
--IN (
--2707,
--2998,
--3219,
--3665
--)
--order by [Answer_pk]
--/**********************************************************************************************************************************************************/
--/**********************************************************************************************************************************************************/
----- TEST: check 14/18 answers linked ONLY ONCE to Ctry+Var+Yr
--SELECT * FROM  [GRSHRcode].[dbo].[tr___01_]
--   INNER JOIN      [FORUM].[dbo].[Pew_Answer]                               T
--      ON 
--                  [Answer_fk]
--                 =[Answer_pk]
--WHERE
--[Answer_pk]
--IN (
--7049,
--7053,
--7181,
--19410,
--19414,
--19504,
--26961,
--26965,
--27015,
--27055,
--32058,
--32062,
--32112,
--32151
--)
--/**********************************************************************************************************************************************************/


/**********************************************************************************************************************************************************/
--- 46 records where I replaced text, value, and link to StdAnswer
)
/**********************************************************************************************************************************************************/
-- Update from CTE table:
--   LINKED tables cannot be directly used if >1 table would have the same exposed name
--   Then we use correlation names to distinguish them.
--    UPDATE    [forum].[dbo].[Pew_Answer_NoStd]
--    SET       [forum].[dbo].[Pew_Answer_NoStd].[Answer_value_NoStd]   =  [BKUP].[Answer_value_NoStd]
--            , [forum].[dbo].[Pew_Answer_NoStd].[Answer_Wording]       =  [BKUP].[Answer_Wording]
--            , [forum].[dbo].[Pew_Answer_NoStd].[Answer_Std_fk]        =  [BKUP].[Answer_Std_fk]
/*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
--------select *
FROM
          [forum].[dbo].[Pew_Answer_NoStd]                               PANS
FULL
JOIN
----   SELECT * FROM
      [_bk_forum].[dbo].[Pew_Answer_NoStd_20161213]                      BKUP
   ON 
       PANS.[Answer_pk]
      =BKUP.[Answer_pk]
WHERE
--       PANS.[Question_fk]
--     !=BKUP.[Question_fk]
--       OR
       PANS.[Answer_Wording]
     !=BKUP.[Answer_Wording]
  AND
       PANS.[Answer_value_NoStd]
     !=BKUP.[Answer_value_NoStd]
  AND
       PANS.[Answer_Std_fk]
     !=BKUP.[Answer_Std_fk]
  AND
       BKUP.[Answer_Wording]     LIKE 'Yes, %'
--     BKUP.[Answer_Wording] NOT LIKE 'Yes, %'

-- order 
--    by PANS.[Answer_pk]
--/**********************************************************************************************************************************************************/
----- TEST: check 08/46 answers linked ONCE to Ctry+Var+Yr
--SELECT * FROM      [FORUM].[dbo].[Pew_Answer]                               T
--   INNER JOIN  [GRSHRcode].[dbo].[tr___01_]
--      ON 
--                  [Answer_fk]
--                 =[Answer_pk]
--WHERE
--[Answer_pk]
--IN (
--2793,
--3084,
--3305,
--3778,
--7235,
--19759,
--27312,
--32417
--)
--order by [Answer_pk]
--/**********************************************************************************************************************************************************/
--/**********************************************************************************************************************************************************/
----- TEST: check 38/46 answers linked ONLY ONCE to Ctry+Var+Yr
--SELECT * FROM      [FORUM].[dbo].[Pew_Answer]                               T
--   INNER JOIN  [GRSHRcode].[dbo].[tr___01_]
--      ON 
--                  [Answer_fk]
--                 =[Answer_pk]
--WHERE
--[Answer_pk]
--IN (
--7097,
--7102,
--7111,
--7256,
--7274,
--7344,
--7360,
--7399,
--19449,
--19551,
--19553,
--19596,
--19635,
--19643,
--19662,
--19678,
--27000,
--27094,
--27102,
--27104,
--27149,
--27187,
--27195,
--27196,
--27214,
--27230,
--27248,
--32097,
--32189,
--32197,
--32199,
--32255,
--32293,
--32301,
--32302,
--32321,
--32337,
--32355
--)
--order by [Answer_pk]
--/**********************************************************************************************************************************************************/
